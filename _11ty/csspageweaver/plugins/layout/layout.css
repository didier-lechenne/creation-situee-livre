/* ============================================================
   PLUGIN LAYOUT - CSS COMPLET AVEC POIGNÉES VISUELLES
   _11ty/csspageweaver/plugins/layout/layout.css
   ============================================================ */

/* === ACTIVATION DU PLUGIN === */

.layout .ui-layout {
  display: block;
}

.ui-layout {
  display: none;
}

/* === ÉLÉMENTS DATA-GRID === */

.modularGrid [data-grid] {
  position: relative;
}

/* État redimensionnable - bordure fine */
.modularGrid [data-grid].resizable {
  outline: 1px solid var(--cssPageWeaver-color-accent) !important;
  outline-offset: -1px;
}

/* === POIGNÉES DE REDIMENSIONNEMENT === */

.resize-handle {
  position: absolute;
  width: 8px;
  height: 8px;
  background: white;
  border: 1.5px solid var(--cssPageWeaver-color-accent);
  box-sizing: border-box;
  pointer-events: auto;
  z-index: 101;
  opacity: 0;
  transition: opacity 0.2s ease;
}

/* Masquer par défaut */
body:not(.layout) .resize-handle {
  display: none;
}

/* Afficher en mode layout sur éléments resizable */
body.layout .modularGrid [data-grid].resizable .resize-handle {
  display: block;
  opacity: 1;
}

/* Positionnement des coins */
.resize-handle.nw {
  top: -4px;
  left: -4px;
  cursor: nw-resize;
}

.resize-handle.ne {
  top: -4px;
  right: -4px;
  cursor: ne-resize;
}

.resize-handle.sw {
  bottom: -4px;
  left: -4px;
  cursor: sw-resize;
}

.resize-handle.se {
  bottom: -4px;
  right: -4px;
  cursor: se-resize;
}

/* Positionnement des bords */
.resize-handle.n {
  top: -4px;
  left: 50%;
  transform: translateX(-50%);
  cursor: n-resize;
}

.resize-handle.s {
  bottom: -4px;
  left: 50%;
  transform: translateX(-50%);
  cursor: s-resize;
}

.resize-handle.w {
  left: -4px;
  top: 50%;
  transform: translateY(-50%);
  cursor: w-resize;
}

.resize-handle.e {
  right: -4px;
  top: 50%;
  transform: translateY(-50%);
  cursor: e-resize;
}

/* État actif pendant le redimensionnement */
.modularGrid [data-grid].resizing .resize-handle {
  background: var(--cssPageWeaver-color-accent);
  border-color: white;
  opacity: 1;
}

.modularGrid [data-grid].resizing .resize-handle:not(.active) {
  opacity: 0.3;
}

/* Hover effet */
body.layout .modularGrid [data-grid].resizable:hover .resize-handle {
  background: var(--cssPageWeaver-color-accent);
  transform: scale(1.1);
}

body.layout .modularGrid [data-grid].resizable:hover .resize-handle.n,
body.layout .modularGrid [data-grid].resizable:hover .resize-handle.s {
  transform: translateX(-50%) scale(1.1);
}

body.layout .modularGrid [data-grid].resizable:hover .resize-handle.w,
body.layout .modularGrid [data-grid].resizable:hover .resize-handle.e {
  transform: translateY(-50%) scale(1.1);
}

/* Variantes par type d'élément */
.modularGrid [data-grid="content"].resizable .resize-handle {
  border-color: #ff6600;
}

.modularGrid [data-grid="image"].resizable .resize-handle {
  border-color: #00cc66;
}

.modularGrid [data-grid="insert"].resizable .resize-handle {
  border-color: #9966cc;
}

.modularGrid [data-grid="content"].resizable:hover .resize-handle {
  background: #ff6600;
}

.modularGrid [data-grid="image"].resizable:hover .resize-handle {
  background: #00cc66;
}

.modularGrid [data-grid="insert"].resizable:hover .resize-handle {
  background: #9966cc;
}

/* === COULEURS PAR TYPE === */

.modularGrid [data-grid="content"].resizable {
  /* outline-color: #ff6600 !important; */
}

.modularGrid [data-grid="image"].resizable {
  /* outline-color: #00cc66 !important; */
}

.modularGrid [data-grid="insert"].resizable {
  /* outline-color: #9966cc !important; */
}

.element-info {
  display: flex;
  align-items: center;
  gap: 1em;
}

#label_rd1::after {
  content: attr(data-name);
  margin-left: 0em;
  font-weight: bold;
  color: var(--cssPageWeaver-color-accent);
}

#position::after {
  content: "Type: " attr(data-shortcode);
  font-size: 0.9em;
  color: var(--cssPageWeaver-color-accent);
}

/* === BOUTON DE DÉPLACEMENT === */

.move-button {
  position: absolute;
  top: 25px;
  left: 25px;
  width: calc(100% - 25px - 25px);
  height: calc(100% - 25px - 25px);
  background: transparent;
  border: 0px solid var(--accentColor, #0066cc);
  cursor: move;
  z-index: 100000;
  pointer-events: auto;
  display: flex;
  align-items: center;
  justify-content: center;
}

.move-button {
  display: none;
}

body.layout .modularGrid [data-grid].resizable .move-button {
  display: flex;
}

.modularGrid [data-grid="content"].resizable .move-button {
  border-color: #ff6600;
}

.modularGrid [data-grid="content"].resizable .move-button::before {
  color: #ff6600;
}

.modularGrid [data-grid="image"].resizable .move-button {
  border-color: #00cc66;
}

.modularGrid [data-grid="image"].resizable .move-button::before {
  color: #00cc66;
}

.modularGrid [data-grid="insert"].resizable .move-button {
  border-color: #9966cc;
}

.modularGrid [data-grid="insert"].resizable .move-button::before {
  color: #9966cc;
}

/* === ÉTATS DE REDIMENSIONNEMENT === */

body.grid-resizing {
  user-select: none;
  cursor: inherit !important;
}

body.grid-resizing * {
  pointer-events: none !important;
}

body.grid-resizing [data-grid],
body.grid-resizing [data-grid] * {
  pointer-events: auto !important;
}

.modularGrid [data-grid].resizing {
  outline-color: #ff6600 !important;
  outline-width: 2px !important;
  z-index: 1000;
}

.modularGrid [data-grid].resizing .move-button {
  background: transparent;
  border-color: white;
}

.modularGrid [data-grid].resizing .move-button::before {
  color: white;
}

/* === ÉTATS DE SÉLECTION === */

.layout [data-grid="insert"].selected {
  outline: 1px dashed var(--accentColor);
}

.layout [data-grid="content"].selected,
.layout [data-grid="image"].selected {
  background-color: hsla(16, 100%, 50%, 0.15);
}

.layout [data-grid="insert"].selected,
.layout [data-grid="content"].selected,
.layout [data-grid="image"].selected,
.layout [data-grid="insert"]:hover,
.layout [data-grid="content"]:hover,
.layout [data-grid="image"]:hover {
  background-color: hsla(16, 100%, 50%, 0.15);
}

/* === INTERFACE UTILISATEUR === */

[type="checkbox"],
[type="radio"] {
  box-sizing: border-box;
  padding: 0;
}

.box {
  display: flex;
  align-items: center;
  justify-content: center;
  color: #aaa;
  font-size: 1.5rem;
  user-select: none;
}

.box input[type="radio"] + label:hover::after {
  background-color: var(--cssPageWeaver-color-accent-hover);
  fill: var(--cssPageWeaver-color-accent-hover);
}

.box input[type="radio"] + label:hover::before {
  background-color: var(--cssPageWeaver-color-accent-hover);
}

.box input[type="radio"] + label:before {
  margin-right: 0ch !important;
}

.box input[type="radio"] + label {
  margin-bottom: 0ch !important;
}

.ui-layout:has(#position[data-shortcode="markdown"]) #gridStudio-image {
  display: none;
}

.ui-layout:has(#position[data-shortcode="image"]) #gridStudio-image {
  display: flex;
}

.ui-layout:has(#position[data-shortcode="image"]) #gridStudio-valign {
  display: none;
}

.ui-layout:has(#position[data-shortcode="markdown"]) #gridStudio-valign {
  display: flex;
}

/* === AFFICHAGE DE L'INDICATEUR AU SURVOL === */

body.layout .modularGrid [data-grid].resizable:hover::after {
  opacity: 1;
}

/* === PAGE TEMPLATE === */

@page modularGrid:left {
  margin-top: 15mm;
  margin-bottom: 15mm;
  margin-left: 15mm;
  margin-right: 15mm;
}

@page modularGrid:right {
  margin-top: 15mm;
  margin-bottom: 15mm;
  margin-left: 15mm;
  margin-right: 15mm;
}

@page modularGrid {
  background-color: var(--bg-color, white) !important;
}

[data-template="modularGrid"] {
  page: modularGrid;
  page-break-before: always;

  --g-column-count: var(--grid-col, 12);
  --g-column-gutter: var(--grid-col-gutter, 0mm);
  --g-row-count: var(--grid-row, 10);
  --g-row-gutter: var(--grid-row-gutter, 0mm);

  display: grid;
  grid-template-columns: repeat(var(--g-column-count), 1fr);
  grid-template-rows: repeat(var(--g-row-count), 1fr);
  column-gap: var(--g-column-gutter);
  row-gap: var(--g-row-gutter);

  height: calc(
    var(--pagedjs-height) - var(--pagedjs-margin-top) -
      var(--pagedjs-margin-bottom) - var(--pagedjs-bleed-top) -
      var(--pagedjs-bleed-bottom)
  );

  padding-top: 0;
  padding-bottom: 0;
}

.modularGrid .pagedjs_full-page_content {
  left: calc((var(--pagedjs-margin-left) + 6mm) * -1) !important;
  width: calc(var(--pagedjs-pagebox-width) + 6mm + 6mm) !important;
}

/* === ÉLÉMENTS DATA-GRID GÉNÉRIQUES === */

.modularGrid [data-grid] {
  grid-column: var(--print-col, auto) / span var(--print-width, 12);
  grid-row: var(--print-row, auto) / span var(--print-height, 3);
  position: relative;
  padding: 0;
  width: 100%;
  height: auto;
  display: flex;
  justify-content: var(--align-self, flex-start);
  max-width: unset;
  flex-direction: column;
}

.content-wrapper {
  display: flex;
  flex-direction: column;
  width: 100%;
}

/* === ÉLÉMENTS DE CONTENU === */

.modularGrid [data-grid="content"] h1,
.modularGrid [data-grid="content"] h2,
.modularGrid [data-grid="content"] h3,
.modularGrid [data-grid="content"] h4,
.modularGrid [data-grid="content"] div,
.modularGrid [data-grid="content"] p,
.modularGrid [data-grid="content"] blockquote,
.modularGrid .insert h1,
.modularGrid .insert h2,
.modularGrid .insert h3,
.modularGrid .insert h4,
.modularGrid .insert div,
.modularGrid p,
.modularGrid .insert blockquote {
  width: 100%;
  padding: 0;
  overflow: hidden;
}

[data-template="modularGrid"] [data-grid="content"] p,
[data-template="modularGrid"] .insert p,
.modularGrid [data-grid="content"] p,
.modularGrid .insert p {
  margin-top: 0em;
}

[data-template="modularGrid"] [data-grid="content"] p:last-child,
[data-template="modularGrid"] .insert p:last-child,
.modularGrid [data-grid="content"] p:last-child,
.modularGrid .insert p:last-child {
  margin-bottom: 0;
}

/* === ÉLÉMENTS MARKDOWN === */

.modularGrid [data-grid="markdown"] > * {
  padding: 0;
}
